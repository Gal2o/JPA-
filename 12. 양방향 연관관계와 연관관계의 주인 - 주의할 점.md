- ### ⭐양방향 매핑 시, 가장 많이 하는 실수⭐
  ``` java
      Member member = new Member();
      member.setUsername("member1");
      em.persist(member);

      Team team = new Team();
      team.setName("TEAM A");
      team.getMembers().add(member);
      em.persist(team);
  ```
  - ![image](https://user-images.githubusercontent.com/35948339/144380492-7edf4e0f-4251-42bb-8a66-02b0c53c86df.png)
  - #### 연관관계의 주인은 member.team
  - #### mappedBy는 team.member
  - #### DB에 결과 값을 보면, member에 team값이 저장이 되지 않는다.
  - #### `읽기 전용인 team.member`에 저장을 하면 `메모리상에는 저장`이 되지만, `DB에 저장이 되지 않아` Null이다.
------
  ``` java
      Team team = new Team();
      team.setName("TEAM A");
      em.persist(team);

      Member member = new Member();
      member.setUsername("member1");
      member.setTeam(team);
      em.persist(member);
  ```
  - ![image](https://user-images.githubusercontent.com/35948339/144524529-871ec11e-b395-4c3f-8be9-b24fa68a8faa.png)
  - #### `연관관계의 주인이 아닌` team을 먼저 1차 캐시에 저장하고
  - #### `연관관계의 주인인 member`에 이미 `저장된 team`을 넣어야만 정상적으로 DB에 저장이 된다.
------
- ### 객체 지향 관점에서 봤을 때, `순수 객체 상태`를 고려하여 항상 `양쪽에 값을 저장`하자
  - #### ‼ `객체를 양방향으로 저장을 안했을 경우`
    - #### 1️⃣ 양방향 객체 저장 ❌, flush, clear ✔
    ``` java
        Team team = new Team();
        team.setName("TEAM A");
        em.persist(team);

        Member member = new Member();
        member.setUsername("member1");
        member.setTeam(team);
        em.persist(member);

        em.flush(); // DB에 동기화
        em.clear(); // 쓰기 지연 SQL, 1차 캐시 초기화

        // select를 통해 값을 가져와서
        // 다시 1차 캐시에 저장
        Team findTeam = em.find(Team.class, team.getId());
        List<Member> members = findTeam.getMembers();

        for (Member m : members)
            System.out.println("m =" + m.getUsername());

        tx.commit();

        // 결과값
        m = member1
    ```
    - #### 이러한 경우에는, List<Member> 값이 잘 나온다.
    - #### DB에 저장도 정상적이고, 1차 캐시를 비워도 select를 통해 다시 1차 캐시에 저장하여 <br><br> 값을 메모리에 저장했으므로, 정상적으로 값이 담겨있다.
  -------
    - #### 2️⃣ 양방향 객체 저장 ❌, flush, clear ❌
    ``` java
        Team team = new Team();
        team.setName("TEAM A");
        em.persist(team);

        Member member = new Member();
        member.setUsername("member1");
        member.setTeam(team);
        em.persist(member);

        // em.flush();
        // em.clear();
        
        // H2 데이터베이스 GeneratedValue = AUTO 이면 SEQUENCE 전략
        // Hibernate_Sequence 테이블을 통해 id 값을 관리한다.
        // Team에는 1차 캐시에 ID 값이 세팅되어 있다.
        Team findTeam = em.find(Team.class, team.getId());
        
        
        List<Member> members = findTeam.getMembers();

        System.out.println(findTeam.getId());
        System.out.println(findTeam.getName());
        System.out.println(members.size());

        tx.commit();
    ```
